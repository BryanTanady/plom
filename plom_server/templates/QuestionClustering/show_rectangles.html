<!--
    SPDX-License-Identifier: AGPL-3.0-or-later
    Copyright (C) 2025 Bryan Tanady
-->
{% extends "base/base.html" %}
{% load static %}
{% block title %}
    Rectangles from v {{ version }} p {{ page_num }}
{% endblock title %}
{% block page_heading %}
    Rectangles from v {{ version }} p {{ page_num }}
{% endblock page_heading %}
{% block main_content %}
    <div>
        <a class="btn btn-success" href="{% url 'question_clustering_home' %}">
            <i class="bi bi-chevron-left"></i>
            Return to choose version/question
        </a>
    </div>
    <div class="card m-2">
        <div class="card-body">
            <h5 class="card-title">Preview of extracted rectangles for Version {{ version }} page {{ page_num }}</h5>
            <form method="post" action="{% url 'question_clustering_jobs_home' %}">
                {% csrf_token %}
                <ul hidden>
                    <input name="question" value="{{ question_index }}" readonly>
                    <input name="version" value="{{ version }}" readonly>
                    <input name="page_num" value="{{ page_num }}" readonly>
                    <input name="plom_top" value="{{ top }}" readonly>
                    <input name="plom_left" value="{{ left }}" readonly>
                    <input name="plom_bottom" value="{{ bottom }}" readonly>
                    <input name="plom_right" value="{{ right }}" readonly>
                </ul>
                <button type="submit" class="btn btn-primary">Begin clustering</button>
            </form>
            {% if papers %}
                <p>
                    <ul>
                        <div class="container">
                            <div class="row">
                                {% for pn in papers %}
                                    <div class="col-6 mb-4">
                                        <strong>Paper {{ pn }}:</strong>
                                        <br />
                                        <img class="img-fluid border p-2"
                                             src="{% url 'extracted_rectangle' pn version page_num %}?left={{ left }}&top={{ top }}&right={{ right }}&bottom={{ bottom }}"
                                             onerror="imgError(this)" />
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </ul>
                </p>
            {% else %}
                <p>
                    There are no papers with version {{ version }} of page {{ page_num }}. This could be because
                    <ul>
                        <li>You have not finished uploading scans</li>
                        <li>
                            Your test specification, or question-version map, may not allow page {{ page_num }} to be chosen from version {{ version }}
                        </li>
                    </ul>
                </p>
            {% endif %}
        </div>
    </div>
    <script type="text/javascript">
  function imgError(image) {
    var img_error_span = document.createElement('span');
    img_error_span.classList.add("alert", "alert-warning", "mx-2", "py-0");
    img_error_span.innerHTML = "Could not extract rectangle.";

    image.parentNode.insertBefore(img_error_span, image);
    image.parentNode.removeChild(image);
  }
    </script>
{% endblock main_content %}
