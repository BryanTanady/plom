<!--
    SPDX-License-Identifier: AGPL-3.0-or-later
    Copyright (C) 2024 Aidan Murphy
-->
{% extends "base/base.html" %}
{% block page_heading %}
    Manage prenaming
{% endblock page_heading %}
{% block main_content %}
    <div class="d-grid gap-2">
        <div>
            <a class="btn btn-primary" href="{% url 'prep_landing' %}">Return to assessment preparation page</a>
        </div>
        <div class="container">
            <div class="row">
                <div class="card w-50">
                    <div class="col-md-6">
                        <div class="card-body">
                            <h5 class="card-title">Prenaming configuration</h5>
                            <div class="col">
                                <p class="card-text">
                                    Adjust <code style="color:black">x, y</code> coordinates of prenaming box.
                                </p>
                            </div>
                            <div class="form-group">
                                <form action="{% url 'configure_prenaming' %}" method="post">
                                    <div class="input-group ms-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text rounded-0">x</span>
                                        </div>
                                        <input class="form-input border"
                                               type="number"
                                               name="xPos"
                                               id="xPos"
                                               value="{{ prename_config.xcoord }}"
                                               style="width:60px">
                                        <div class="input-group-prepend ms-3">
                                            <span class="input-group-text rounded-0">y</span>
                                        </div>
                                        <input class="form-input border"
                                               type="number"
                                               name="yPos"
                                               id="yPos"
                                               value="{{ prename_config.ycoord }}"
                                               style="width:60px">
                                    </div>
                                </div>
                                {% csrf_token %}
                                <input class="btn btn-primary mt-2"
                                       type="submit"
                                       name="set_config"
                                       value="Save configuration">
                                <input class="btn btn-primary mt-2"
                                       type="submit"
                                       name="reset_config"
                                       value="reset configuration to defaults">
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card w-75">
                        <img id="mockPNG" src="" />
                    </div>
                </div>
            </div>
        </div>
        <script>
			const debounce = (callback, waitTime) => {
			    let timer;
			    return (...args) => {
				clearTimeout(timer);
				timer = setTimeout(() => {
				    callback(...args);
				}, waitTime);
			    };
			}
			const mock_png = () => {
				var xPos = document.getElementById("xPos").value
				var yPos = document.getElementById("yPos").value
				fetch(`{% url 'prep_mock_prename' %}?xcoord=${xPos}&ycoord=${yPos}`)
				    .then(response => {return response.blob()})
				    .then(blob => {
					const img_url = URL.createObjectURL(blob);
					document.getElementById("mockPNG").src = img_url;
				    })
				    .catch(error => console.error("Error loading mock ID page image:", error));
			}

			document.addEventListener("DOMContentLoaded", function() {
				document.getElementById("xPos").addEventListener("input", debounce(mock_png, 200));
				document.getElementById("yPos").addEventListener("input", debounce(mock_png, 200));
		});
        </script>
    </div>
{% endblock main_content %}
