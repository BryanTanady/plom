{% extends "base/base.html" %}
{% load static %}
<!DOCTYPE html>
<!--
    SPDX-License-Identifier: AGPL-3.0-or-later
    Copyright (C) 2022 Edith Coates
    Copyright (C) 2022 Brennen Chiu
    Copyright (C) 2023 Andrew Rechnitzer
    Copyright (C) 2023 Colin B. Macdonald
-->
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>
            {% block title %}
                Reassemble Papers
            {% endblock title %}
        </title>
    </head>
    <body>
        {% block page_heading %}
            Reassemble Papers
        {% endblock page_heading %}
        {% block main_content %}
            <div class="d-grid gap-2" id="top">
                <div id="pdf_table"></div>
                <div class="card w-50">
                    <div class="card-body">
                        <table class="table table-striped">
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Identified</th>
                                <th scope="col">Marked</th>
                                <th scope="col">Last updated</th>
                                <th scope="col">Status</th>
                                <th scope="col">Action</th>
                            </tr>
                            {% for paper, val in papers.items %}
                                {% if val.scanned %}
                                    <tr>
                                        <td>{{ paper }}</td>
                                        <td>
                                            {% if val.identified %}
                                                <i class="bi bi-check-circle text-success"></i> {{ val.student_id }}
                                            {% else %}
                                                <i class="bi bi-exclamation-diamond-fill text-warning"></i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if val.marked %}
                                                <i class="bi bi-check-circle text-success"></i> all
                                            {% else %}
                                                {% if val.number_marked == 0 %}
                                                    <i class="bi bi-exclamation-diamond-fill text-danger"></i> none
                                                {% else %}
                                                    <i class="bi bi-exclamation-diamond-fill text-warning"></i> {{ val.number_marked }}
                                                {% endif %}
                                            {% endif %}
                                        </td>
                                        <td>{{ val.last_update_humanised }}</td>
                                        <td>
                                            {% if val.reassembled_time %}
                                                {{ val.reassembled_time_humanised }}
                                                {% if val.outdated %}<i class="bi bi-exclamation-diamond-fill text-danger"></i> outdated{% endif %}
                                            {% else %}
                                                {% if val.identified and val.marked %}
                                                    not yet
                                                {% else %}
                                                    not ready
                                                {% endif %}
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if val.reassembled_time %}
                                                {% if val.outdated %}
                                                    <i class="bi bi-exclamation-diamond-fill text-danger"></i> outdated
                                                    <button class="btn btn-info">re-reassemble</button>
                                                {% endif %}
                                                <button class="btn btn-warning">delete</button>
                                            {% else %}
                                                {% if val.identified and val.marked %}
                                                    <button hx-post="{% url 'reassemble_one_paper' paper %}"
                                                            class="btn btn-success">reassemble</button>
                                                {% else %}
                                                    <i class="bi bi-exclamation-diamond-fill text-info"></i>
                                                {% endif %}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
        {% endblock main_content %}
    </body>
</html>
